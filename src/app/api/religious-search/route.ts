// API ููุจุญุซ ุงูุฏููู - Religious Search API
import { NextRequest, NextResponse } from 'next/server';

interface ReligiousSearchResult {
  text: string;
  source: string;
  reference?: string;
}

interface ReligiousSearchResponse {
  shiite_sources: ReligiousSearchResult[];
  sunni_source: ReligiousSearchResult;
}

// ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ ููุฃุญูุงู ุงูุฏูููุฉ (ูููู ุงุณุชุจุฏุงููุง ุจู API ุฎุงุฑุฌู)
const religiousDatabase = {
  "ุงูุจูุฑุฉ": {
    shiite_sources: [
      {
        text: "ุดุฑุจ ุงูุจูุฑุฉ ูุญุฑู ูุทุนุงู ูุฃููุง ุชุญุชูู ุนูู ูุณุจุฉ ูู ุงููุญููุ ููู ูุง ุฃุณูุฑ ููููู ููุซูุฑู ุญุฑุงู.",
        source: "ููู ุงูุฅูุงู ุงูุฎูุฆู",
        reference: "ูููุงุฌ ุงูุตุงูุญูู - ูุชุงุจ ุงูุฃุทุนูุฉ ูุงูุฃุดุฑุจุฉ"
      },
      {
        text: "ุงููุดุฑูุจุงุช ุงููุญูููุฉ ุจูุง ูููุง ุงูุจูุฑุฉ ูุญุฑูุฉ ุดุฑุนุงูุ ุญุชู ูู ูุงูุช ูุณุจุฉ ุงููุญูู ููููุฉ.",
        source: "ูุชุงูู ุงูุณูุฏ ุงูุณูุณุชุงูู",
        reference: "ุงููุณุงุฆู ุงูููุชุฎุจุฉ - ูุณุฃูุฉ 432"
      }
    ],
    sunni_source: {
      text: "ุงูุจูุฑุฉ ูุญุฑูุฉ ูู ุงููุฐุงูุจ ุงูุฃุฑุจุนุฉ ูุงุญุชูุงุฆูุง ุนูู ุงููุญููุ ูุงููุจู ๏ทบ ูุงู: 'ูู ูุณูุฑ ุฎูุฑ ููู ุฎูุฑ ุญุฑุงู'.",
      source: "ููู ุงููุฐุงูุจ ุงูุฃุฑุจุนุฉ",
      reference: "ุตุญูุญ ูุณูู - ูุชุงุจ ุงูุฃุดุฑุจุฉ"
    }
  },
  "ุงูุฎูุฑ": {
    shiite_sources: [
      {
        text: "ุงูุฎูุฑ ูู ุฃูุจุฑ ุงููุจุงุฆุฑ ููู ูุญุฑูุฉ ูุทุนูุงู ุจูุต ุงููุฑุขู ุงููุฑูู ูุงูุณูุฉ ุงููุจููุฉ.",
        source: "ุงูููู ุงูููุงุฑู",
        reference: "ุงููุฑุขู ุงููุฑูู - ุณูุฑุฉ ุงููุงุฆุฏุฉ ุขูุฉ 90"
      },
      {
        text: "ุดุฑุจ ุงูุฎูุฑ ููุฌุจ ุงูุญุฏ ุงูุดุฑุนู ููู ูู ุงูุฐููุจ ุงูุชู ุชุณุชูุฌุจ ุงูุชูุจุฉ ุงููุตูุญ.",
        source: "ูุชุจ ุงูููู ุงูุฅูุงูู",
        reference: "ุดุฑุงุฆุน ุงูุฅุณูุงู - ูุชุงุจ ุงูุญุฏูุฏ"
      }
    ],
    sunni_source: {
      text: "ุงูุฎูุฑ ูุญุฑู ุจุฅุฌูุงุน ุงูุฃูุฉุ ููุฏ ูุฒู ุชุญุฑููู ุตุฑูุญุงู ูู ุงููุฑุขู ุงููุฑูู.",
      source: "ุฅุฌูุงุน ุงููููุงุก",
      reference: "ุณูุฑุฉ ุงููุงุฆุฏุฉ: ุฅููุง ุงูุฎูุฑ ูุงูููุณุฑ... ุฑุฌุณ ูู ุนูู ุงูุดูุทุงู"
    }
  },
  "ุงูุตูุงุฉ": {
    shiite_sources: [
      {
        text: "ุงูุตูุงุฉ ุนููุฏ ุงูุฏููุ ูู ุชุฑููุง ููุฏ ูุฏู ุฏูููุ ููู ุฃูู ูุง ูุญุงุณุจ ุนููู ุงูุนุจุฏ ููู ุงูููุงูุฉ.",
        source: "ุงููุงูู ููููููู",
        reference: "ูุชุงุจ ุงูุตูุงุฉ - ุจุงุจ ูุถู ุงูุตูุงุฉ"
      },
      {
        text: "ุงูุตููุงุช ุงูุฎูุณ ูุงุฌุจุฉ ุนูู ูู ููููุ ูุงูุฌูุนุฉ ุชุณูุท ุงูุธูุฑ ุนูุฏ ุงุฌุชูุงุน ุดุฑูุทูุง.",
        source: "ุชุญุฑูุฑ ุงููุณููุฉ",
        reference: "ูุชุงุจ ุงูุตูุงุฉ - ูุตู ุฃุนุฏุงุฏ ุงููุฑุงุฆุถ"
      }
    ],
    sunni_source: {
      text: "ุงูุตูุงุฉ ุงูุฑูู ุงูุซุงูู ูู ุฃุฑูุงู ุงูุฅุณูุงูุ ููู ุงููุงุฑู ุจูู ุงููุคูู ูุงููุงูุฑ ููุง ูุฑุฏ ูู ุงูุญุฏูุซ.",
      source: "ุงูููู ุงูุณูู",
      reference: "ุญุฏูุซ: ุจูู ุงูุฑุฌู ูุจูู ุงูุดุฑู ูุงูููุฑ ุชุฑู ุงูุตูุงุฉ"
    }
  },
  "ุงูุฒูุงุฉ": {
    shiite_sources: [
      {
        text: "ุงูุฒูุงุฉ ุญู ุงููุงู ูุทูุงุฑุฉ ููููุณุ ุชุฌุจ ูู ุชุณุนุฉ ุฃุดูุงุก ุญุณุจ ุงููุฐูุจ ุงูุฅูุงูู.",
        source: "ููู ุงูุฅูุงู ุงูุตุงุฏู",
        reference: "ูุชุงุจ ุงูุฒูุงุฉ - ุงูุฃููุงู ุงูุชู ุชุฌุจ ูููุง ุงูุฒูุงุฉ"
      },
      {
        text: "ูุตุงุฑู ุงูุฒูุงุฉ ุซูุงููุฉ ููุง ูุต ุนูููุง ุงููุฑุขูุ ููุง ูุฌูุฒ ุฏูุนูุง ูุบูุฑ ูุณุชุญูููุง.",
        source: "ุงูุฑุณุงุฆู ุงูุนูููุฉ",
        reference: "ุณูุฑุฉ ุงูุชูุจุฉ ุขูุฉ 60"
      }
    ],
    sunni_source: {
      text: "ุงูุฒูุงุฉ ุงูุฑูู ุงูุซุงูุซ ูู ุฃุฑูุงู ุงูุฅุณูุงูุ ุชุฌุจ ูู ุงููุงู ุงููุงูู ุงูุฐู ุญุงู ุนููู ุงูุญูู.",
      source: "ููู ุงูุฒูุงุฉ",
      reference: "ุงููุฑุขู ูุงูุณูุฉ - ุฃุญุงุฏูุซ ุงูุฒูุงุฉ"
    }
  }
};

// ุฏุงูุฉ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
function searchInDatabase(query: string): ReligiousSearchResponse | null {
  const queryLower = query.toLowerCase();
  
  // ุงูุจุญุซ ุนู ุงููููุงุช ุงูููุชุงุญูุฉ
  for (const [key, value] of Object.entries(religiousDatabase)) {
    if (queryLower.includes(key.toLowerCase()) || 
        queryLower.includes('ุดุฑุจ') && key === 'ุงูุจูุฑุฉ' ||
        queryLower.includes('ูุญูู') && key === 'ุงูุจูุฑุฉ' ||
        queryLower.includes('ูุณูุฑ') && (key === 'ุงูุจูุฑุฉ' || key === 'ุงูุฎูุฑ')) {
      return value;
    }
  }
  
  return null;
}

// ุฏุงูุฉ ุงูุจุญุซ ุงูุนุงูุฉ ููุฃุณุฆูุฉ ุบูุฑ ุงููุญุฏุฏุฉ
function getGeneralReligiousResponse(query: string): ReligiousSearchResponse {
  return {
    shiite_sources: [
      {
        text: `ุณุคุงูู "${query}" ูุชุทูุจ ูุฑุงุฌุนุฉ ุงููุตุงุฏุฑ ุงูููููุฉ ุงููุนุชูุฏุฉ ูุงูุฑุณุงุฆู ุงูุนูููุฉ ูููุฑุงุฌุน ุงูุนุธุงู.`,
        source: "ุงููุฑุงุฌุน ุงูุดูุนูุฉ ุงููุนุงุตุฑุฉ",
        reference: "ููุญุตูู ุนูู ูุชูู ุฏูููุฉุ ูููุตุญ ุจูุฑุงุฌุนุฉ ููุชุจ ุงููุฑุฌุน ูุจุงุดุฑุฉ"
      },
      {
        text: `ูู ุงููุณุงุฆู ุงูููููุฉ ุงููุนูุฏุฉ ูุซู ูุฐูุ ูู ุงูููู ุงูุฑุฌูุน ููุนููุงุก ุงููุฎุชุตูู.`,
        source: "ุงูุญูุฒุฉ ุงูุนูููุฉ",
        reference: "ุงุณุชุดุงุฑุฉ ุทูุจุฉ ุงูุนููู ุงูุฏูููุฉ ุงููุคูููู"
      }
    ],
    sunni_source: {
      text: `ูุณุคุงูู "${query}"ุ ุฃูุตุญ ุจูุฑุงุฌุนุฉ ูุชุจ ุงูููู ุงููุนุชูุฏุฉ ูู ุงููุฐุงูุจ ุงูุฃุฑุจุนุฉ ูุฏูุฑ ุงูุฅูุชุงุก.`,
      source: "ุฏูุฑ ุงูุฅูุชุงุก ุงููุนุชูุฏุฉ",
      reference: "ุงูุฃุฒูุฑ ุงูุดุฑูู - ุฏุงุฑ ุงูุฅูุชุงุก ุงููุตุฑูุฉ - ุงููุฌุงูุน ุงูููููุฉ"
    }
  };
}

export async function POST(req: NextRequest) {
  try {
    const { query } = await req.json();
    
    if (!query || typeof query !== 'string') {
      return NextResponse.json(
        { error: 'ุงุณุชุนูุงู ุบูุฑ ุตุญูุญ' },
        { status: 400 }
      );
    }

    console.log(`๐ ุจุญุซ ุฏููู: "${query}"`);

    // ุงุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ุฃููุงู
    let searchResult = searchInDatabase(query);
    
    // ุฅุฐุง ูู ูุฌุฏ ูุชุงุฆุฌ ูุญุฏุฏุฉุ ุงุนุทู ุฑุฏ ุนุงู
    if (!searchResult) {
      searchResult = getGeneralReligiousResponse(query);
    }

    return NextResponse.json({
      success: true,
      query: query,
      results: searchResult,
      source: 'local_database',
      timestamp: new Date().toISOString()
    });

  } catch (error) {
    console.error('ุฎุทุฃ ูู API ุงูุจุญุซ ุงูุฏููู:', error);
    
    return NextResponse.json(
      { 
        error: 'ุฎุทุฃ ูู ุงูุฎุงุฏู ุฃุซูุงุก ุงูุจุญุซ',
        message: 'ุญุงูู ูุฑุฉ ุฃุฎุฑู ูุงุญูุงู' 
      },
      { status: 500 }
    );
  }
}

export async function GET() {
  return NextResponse.json({
    message: 'API ุงูุจุญุซ ุงูุฏููู ุฌุงูุฒ',
    version: '1.0.0',
    endpoints: {
      search: 'POST /api/religious-search'
    },
    database_topics: Object.keys(religiousDatabase)
  });
}